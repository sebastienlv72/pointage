<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pointage SheetDB</title>
<style>
body { font-family:'Inter',sans-serif; text-align:center; padding:20px; background:#f4f4f9; }
#punchForm {background:#fff; max-width:350px; margin:20px auto; padding:25px; border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,0.1);}
input, button {padding:10px; margin:10px 0; width:100%; border-radius:8px; border:1px solid #ddd; font-size:16px;}
button {cursor:pointer; background:#3b5bff; color:#fff; font-weight:600; border:none;}
button:hover {background:#2a4ae3;}
#status {margin-top:15px; font-weight:500;}
#uuidInfo {font-size:12px; color:#777;}
</style>
</head>
<body>

<h1>Pointage des Heures</h1>

<form id="punchForm">
  <input type="text" id="sheetdbId" placeholder="ID SheetDB (ex: ren8pqvx9agdt)" required>
  <input type="text" id="name" placeholder="Votre nom complet" required>
  <button type="submit" id="punchIn">Pointer Entrée</button>
  <button type="button" id="punchOut">Pointer Sortie</button>
</form>

<div id="status">Statut : En attente...</div>
<p id="uuidInfo"></p>

<script>
const uuid = localStorage.getItem("punch_uuid") || generateUUID();
document.getElementById("uuidInfo").textContent = "UUID : " + uuid;

function generateUUID() {
  const id = 'web-' + Date.now().toString(36) + Math.random().toString(36).substr(2,6);
  localStorage.setItem("punch_uuid", id);
  return id;
}

function getAPIUrl() {
  const sheetdbId = document.getElementById("sheetdbId").value.trim();
  if(!sheetdbId) throw new Error("ID SheetDB manquant");
  return `https://sheetdb.io/api/v1/${sheetdbId}`;
}

async function postPunch(type) {
  const name = document.getElementById("name").value.trim();
  if(!name) { alert("Veuillez entrer votre nom complet"); return; }
  const url = getAPIUrl();
  const payload = {
    data: [{
      UUID: uuid,
      NomComplet: name,
      TypeAction: type,
      Date: new Date().toLocaleDateString('fr-FR'),
      Heure: new Date().toLocaleTimeString('fr-FR', {hour:'2-digit',minute:'2-digit'})
    }]
  };
  try {
    document.getElementById("status").textContent = "⏳ Enregistrement...";
    const res = await fetch(url, {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify(payload)
    });
    if(res.ok){
      document.getElementById("status").textContent = "✅ " + type + " enregistrée";
    } else {
      document.getElementById("status").textContent = "❌ Erreur HTTP "+res.status;
    }
  } catch(err) {
    console.error(err);
    document.getElementById("status").textContent = "❌ Erreur : " + err.message;
  }
}

document.getElementById("punchForm").addEventListener("submit", (e) => {
  e.preventDefault();
  postPunch("PointageIN");
});

document.getElementById("punchOut").addEventListener("click", () => {
  postPunch("PointageOUT");
});
</script>

</body>
</html>
